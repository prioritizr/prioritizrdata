<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tasmania Worked Example • prioritizrdata</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">prioritizrdata</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/prioritizr/prioritizrdata">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Tasmania Worked Example</h1>
            
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The intent of this tutorial is to provide a worked example of how spatial shapefile data can be incorporated into a conservation prioritization problem with <em>prioritizr</em>. For raster data, refer to the <a href="saltspring.html">Salt Spring Island vignette</a>.</p>
<p>The dataset was obtained from the <a href="http://marxan.net/courses">“Introduction to Marxan” course</a> and was originally a subset of a larger spatial prioritization project performed under contract to Australia’s Department of Environment and Water Resources.</p>
<p>This tutorial will use functions from the <em>prioiritizr</em> package. Users can refer to the vignettes built into the <em>prioritizr</em> package to familiarize themselves with the basic usage of <em>prioritizr</em> and the concepts behind the package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(prioritizrdata)
<span class="kw">library</span>(prioritizr)
<span class="kw">library</span>(rasterVis)
<span class="kw">library</span>(viridis)</code></pre></div>
</div>
<div id="exploring-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-the-data" class="anchor"></a>Exploring the data</h2>
<p>This dataset contains two components. First, a planning unit spatial layer, where the attribute table has three columns containing unique identifiers (‘ids’), unimproved land values (‘cost’), and their existing level of protection (‘status’). Units with 50% or more of their area contained in IUCN protected areas are associated with a status of 2, otherwise they are associated with a value of 0. Users familiar with Marxan formatting will notice that this formatting follows Marxan input file specifications. In Marxan, planning units must be described in a table containing one row for each planning unit with a unique ID and the corresponding cost. This will become important for problem formulation with this dataset, as both the <code>problem</code> and <code>marxan_problem</code> functions can be used.</p>
<p>The second component of this dataset is the feature data. This is a <code>RasterStack</code> class object, where each layer in the stack represents the distribution of a different vegetation class in Tasmania, Australia. There are 62 vegetation classes in total. For a given layer, cells indicate the presence (value of 1) or absence (value of 0) of the vegetation class in an area.</p>
<p>First, load the data into the R environment:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(tas_pu)       <span class="co"># planning units</span>
<span class="kw">data</span>(tas_features) <span class="co"># biodiversity features</span></code></pre></div>
<p>Let’s have a look at the planning unit data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(tas_pu)</code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 1130 
## extent      : 1080623, 1399989, -4840595, -4497092  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs 
## variables   : 5
## names       :   id,              cost, status, locked_in, locked_out 
## min values  :    1, 0.192488262910798,      0,         0,          0 
## max values  : 1130,  61.9272727272727,      2,         1,          0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">spplot</span>(tas_pu, <span class="dt">zcol =</span> <span class="st">"cost"</span>, <span class="dt">names.attr =</span> <span class="st">"Cost"</span>,
       <span class="dt">main =</span> <span class="st">"Planning Units and Cost"</span>, <span class="dt">col.regions =</span> <span class="kw">rev</span>(<span class="kw">viridis</span>(<span class="dv">100</span>)))</code></pre></div>
<p><img src="tasmania_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Next, the feature data. We’ve only plotted the first four features as an example. Pixels value denotes the presence or absence of that feature within the study area extent.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(tas_features)</code></pre></div>
<pre><code>## class       : RasterStack 
## dimensions  : 343, 320, 109760, 62  (nrow, ncol, ncell, nlayers)
## resolution  : 1000, 1000  (x, y)
## extent      : 1080496, 1400496, -4841217, -4498217  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs 
## names       : layer.1, layer.2, layer.3, layer.4, layer.5, layer.6, layer.7, layer.8, layer.9, layer.10, layer.11, layer.12, layer.13, layer.14, layer.15, ... 
## min values  :       0,       0,       0,       0,       0,       0,       0,       0,       0,        0,        0,        0,        0,        0,        0, ... 
## max values  :       1,       1,       1,       1,       1,       1,       1,       1,       1,        1,        1,        1,        1,        1,        1, ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levelplot</span>(tas_features[[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]], <span class="dt">main =</span> <span class="st">"Ecological Features"</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),
          <span class="dt">col.regions =</span> <span class="kw">rev</span>(<span class="kw">magma</span>(<span class="dv">100</span>)))</code></pre></div>
<p><img src="tasmania_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="example-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#example-usage" class="anchor"></a>Example Usage</h2>
<p>Because the Tasmania planning units are a spatial polygon layer, not a raster, there is more flexibility in the type of costs and features that can be used in problem formulation. That said, there is a trade-off with the efficiency of solving. Inputting planning units as a raster will usually produce solutions faster, but to take advantage of this you will have to coerce all of the data into the same raster grid dimensions, which is not always feasible or desirable.</p>
<p>We will give an example of problem formulation with this dataset using the fully customizable <code>problem</code> function, and then the simpler but more limited <code>marxan_problem</code> function as a comparison.</p>
<div id="marxan-problem-formulation" class="section level3">
<h3 class="hasAnchor">
<a href="#marxan-problem-formulation" class="anchor"></a>Marxan problem formulation</h3>
<p>The files in this dataset follow the conventions used by Marxan, so problems can be formulated simply and easily with the Marxan problem function, which provides a single function wrapper for problem objects, penalties, and constraints. The problem object produced by this function will still use an exact integer linear programming solver, so in that way departs from traditional Marxan solving with simulated annealing. The <code>marxan_problem</code> approach is considerably more limited than the key <em>prioritizr</em> problem functions, but has the same functionality as Marxan and may therefore be handy to users familiar with Marxan.</p>
<p>All problem objects formulated with <code>marxan_problem</code> use the minimum set objective. Targets can be either relative or absolute, and planning units can be specified for masking in or out using the <code>locked_in</code> and <code>locked_out</code> arguments. To favor clumped solutions, use the <code>penalty</code> argument to impose a penalty on solutions with high boundary lengths (equivalent to the Boundary Length Modifier (BLM) used in Marxan), and the <code>edge_factor</code> argument to scale the penalty for edges that do not have neighboring planning units, such as coastline. Cost does not have to be explicitly identified with the <code>marxan_problem</code>, because if column names follow Marxan conventions, the cost column can be located by the function.</p>
<p>For simplicity we set all of the targets at the same level, 17%, to reflect the <a href="https://www.cbd.int/sp/targets/">Aichi</a> biodiversity target to “safeguard” at least 17% of terrestrial ecosystems by 2020. For example, to prioritize planning units in Tasmania that meet the 17% representation target at the least cost:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw">marxan_problem</span>(tas_pu, tas_features, <span class="dt">targets =</span> <span class="fl">0.17</span>,
                     <span class="dt">targets_type =</span> <span class="st">"relative"</span>, <span class="dt">penalty =</span> <span class="fl">0.0005</span>,
                     <span class="dt">edge_factor =</span> <span class="fl">0.5</span>, <span class="dt">cost_column =</span> <span class="st">"cost"</span>)</code></pre></div>
<p>Note: the formulation of a Marxan problem is slightly different for Marxan input files (i.e. with a “.dat” extension). Refer to the help pages and the quick start guide for instructions on working with these files.</p>
</div>
<div id="problem-formulation-with-prioritizr-problem-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#problem-formulation-with-prioritizr-problem-functions" class="anchor"></a>Problem formulation with <em>prioritizr</em> problem functions</h3>
<p>This same problem can be formulated with the key <em>prioritizr</em> functions. We recommend this approach for any problem more complex than the simple problem described above, and when input data do not precisely match Marxan formatting conventions. In this example, we leave the decision framework as the default; binary decision making. This means the planning unit is either selected in the solution or not selected - no partial planning units are permitted.</p>
<p>To formulate this problem:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p2 &lt;-<span class="st"> </span><span class="kw">problem</span>(tas_pu, tas_features, <span class="dt">cost_column =</span> <span class="st">"cost"</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_min_set_objective</span>() <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_relative_targets</span>(<span class="fl">0.17</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_binary_decisions</span>() <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">add_boundary_penalties</span>(<span class="dt">penalty =</span> <span class="fl">0.0005</span>, <span class="dt">edge_factor =</span> <span class="fl">0.5</span>)</code></pre></div>
</div>
<div id="solving-a-problem" class="section level3">
<h3 class="hasAnchor">
<a href="#solving-a-problem" class="anchor"></a>Solving a problem</h3>
<p><em>Prioritizr</em> supports three different integer linear programming solver packages: <code>gurobi</code>, <code>Rsymphony</code>, and <code>lpsymphony</code>. There are pros and cons to each of these, but the actual impact of solver type on the planning units in the solution should be relatively minor.</p>
<p>First, remember that the solvers must be installed and loaded separately. We use the<code>gurobi</code> solver in this example, as it is the quickest of the three solvers to find solutions. Both Marxan problem objects and prioritizr problem objects are solved in the same way</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s1 &lt;-<span class="st"> </span><span class="kw">solve</span>(p1) <span class="co"># marxan problem</span></code></pre></div>
<pre><code>## Optimize a model with 6358 rows, 4278 columns and 14152 nonzeros
## Variable types: 0 continuous, 4278 integer (4278 binary)
## Coefficient statistics:
##   Matrix range     [1e-02, 1e+00]
##   Objective range  [5e-02, 1e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [3e-03, 3e+00]
## Found heuristic solution: objective 29458.8
## Found heuristic solution: objective 5983.59
## Presolve removed 34 rows and 25 columns
## Presolve time: 0.04s
## Presolved: 6324 rows, 4253 columns, 14110 nonzeros
## Found heuristic solution: objective 6762.4322957
## Variable types: 0 continuous, 4253 integer (4253 binary)
## Presolved: 6324 rows, 4253 columns, 14110 nonzeros
## 
## 
## Root relaxation: objective 2.510246e+03, 1109 iterations, 0.07 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 2510.24636    0  216 5983.58653 2510.24636  58.0%     -    0s
## H    0     0                    3060.1023375 2510.24636  18.0%     -    0s
## H    0     0                    2904.6014034 2510.24636  13.6%     -    0s
##      0     0 2640.37794    0  262 2904.60140 2640.37794  9.10%     -    0s
## 
## Cutting planes:
##   Gomory: 9
##   Cover: 13
##   MIR: 15
##   StrongCG: 11
##   GUB cover: 2
## 
## Explored 1 nodes (1631 simplex iterations) in 0.42 seconds
## Thread count was 1 (of 4 available processors)
## 
## Solution count 5: 2904.6 3060.1 5983.59 ... 29243.7
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 2.904601403405e+03, best bound 2.640377942458e+03, gap 9.0967%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s2 &lt;-<span class="st"> </span><span class="kw">solve</span>(p2) <span class="co"># prioritizr problem</span></code></pre></div>
<pre><code>## Optimize a model with 6358 rows, 4278 columns and 14152 nonzeros
## Variable types: 0 continuous, 4278 integer (4278 binary)
## Coefficient statistics:
##   Matrix range     [1e-02, 1e+00]
##   Objective range  [5e-02, 1e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [3e-03, 3e+00]
## Found heuristic solution: objective 29458.8
## Found heuristic solution: objective 5983.59
## Presolve removed 34 rows and 25 columns
## Presolve time: 0.03s
## Presolved: 6324 rows, 4253 columns, 14110 nonzeros
## Found heuristic solution: objective 6762.4322957
## Variable types: 0 continuous, 4253 integer (4253 binary)
## Presolved: 6324 rows, 4253 columns, 14110 nonzeros
## 
## 
## Root relaxation: objective 2.510246e+03, 1109 iterations, 0.06 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 2510.24636    0  216 5983.58653 2510.24636  58.0%     -    0s
## H    0     0                    3060.1023375 2510.24636  18.0%     -    0s
## H    0     0                    2904.6014034 2510.24636  13.6%     -    0s
##      0     0 2640.37794    0  262 2904.60140 2640.37794  9.10%     -    0s
## 
## Cutting planes:
##   Gomory: 9
##   Cover: 13
##   MIR: 15
##   StrongCG: 11
##   GUB cover: 2
## 
## Explored 1 nodes (1631 simplex iterations) in 0.38 seconds
## Thread count was 1 (of 4 available processors)
## 
## Solution count 5: 2904.6 3060.1 5983.59 ... 29243.7
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 2.904601403405e+03, best bound 2.640377942458e+03, gap 9.0967%</code></pre>
<p>These solutions can now be plotted.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># reformat solution column to make legends appear nicely</span>
s1<span class="op">$</span>solution_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">factor</span>(s1<span class="op">$</span>solution_<span class="dv">1</span>)
s2<span class="op">$</span>solution_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">factor</span>(s2<span class="op">$</span>solution_<span class="dv">1</span>)

<span class="co"># plot solutions</span>
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">spplot</span>(s1, <span class="st">"solution_1"</span>, <span class="dt">col.regions =</span> <span class="kw">c</span>(<span class="st">'grey90'</span>, <span class="st">'darkgreen'</span>),
       <span class="dt">main =</span> <span class="st">"marxan_problem"</span>)</code></pre></div>
<p><img src="tasmania_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">spplot</span>(s2, <span class="st">"solution_1"</span>, <span class="dt">col.regions =</span> <span class="kw">c</span>(<span class="st">'grey90'</span>, <span class="st">'darkgreen'</span>),
       <span class="dt">main =</span> <span class="st">"full formulation"</span>)</code></pre></div>
<p><img src="tasmania_files/figure-html/unnamed-chunk-9-2.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#exploring-the-data">Exploring the data</a></li>
      <li><a href="#example-usage">Example Usage</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://jeffrey-hanson.com">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com/">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com">Matthew Strimas-Mackey</a>, Matthew E Watts, <a href="http://arcese.forestry.ubc.ca">Peter Arcese</a>, <a href="https://josephrbennett.wordpress.com/">Joeseph Bennett</a>, Hugh P Possingham.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>

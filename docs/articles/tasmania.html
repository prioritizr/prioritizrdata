<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tasmania Example • prioritizrdata</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Tasmania Example">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prioritizrdata</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/saltspring.html">Salt Spring Island Example</a>
    </li>
    <li>
      <a href="../articles/tasmania.html">Tasmania Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/prioritizr/prioritizrdata">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Tasmania Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/prioritizr/prioritizrdata/blob/master/vignettes/tasmania.Rmd"><code>vignettes/tasmania.Rmd</code></a></small>
      <div class="hidden name"><code>tasmania.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level3">
<h3 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h3>
<p>The aim of this tutorial is to provide a worked example of how vector-based data can be used to develop conservation prioritizations using the <em>prioritizr R</em> package. For raster-based data, refer to the <a href="saltspring.html">Salt Spring Island vignette</a>. It is also written for conservation planners that have used the <em>Marxan</em> decision support tool and are interested in applying the <em>prioritizr R</em> package to their own work. The data set used in this tutorial was obtained from the <a href="http://marxan.net/courses">“Introduction to Marxan” course</a>. It was originally a subset of a larger spatial prioritization project performed under contract to Australia’s Department of Environment and Water Resources.</p>
<p>Please note that this tutorial will use functions from the <em>prioritizr R</em> package for building and solving conservation planning problems. For more information on the <em>prioritizr R</em> package, please refer to the <a href="https://prioritizr.github.io/prioritizr">package website</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(prioritizrdata)
<span class="kw">library</span>(prioritizr)
<span class="kw">library</span>(rasterVis)
<span class="kw">library</span>(viridis)</code></pre></div>
</div>
<div id="exploring-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#exploring-the-data" class="anchor"></a>Exploring the data</h3>
<p>This data set contains two items. First, a spatial planning unit layer that has an attribute table which contains three columns: integer unique identifiers (“ids”), unimproved land values (“cost”), and their existing level of protection (“status”). Units with 50 % or more of their area contained in protected areas are associated with a status of 2, otherwise they are associated with a value of 0. If you are familiar with the <em>Marxan</em> decision support tool, then you will notice that these columns are formatted in a similar manner to the input data for <em>Marxan</em>. For <em>Marxan</em> input data, planning units must be described in a table containing one row for each planning unit with a unique identifier and the corresponding cost.</p>
<p>The second item in this data set is the raster-based feature data. Specifically, the feature data is expressed as a stack of rasters (termed a <code>RasterStack</code> object). Here each layer in the stack represents the distribution of a different vegetation class in Tasmania, Australia. There are 62 vegetation classes in total. For a given layer, pixel values indicate the presence (value of 1) or absence (value of 0) of the vegetation class in an area.</p>
<p>First, load the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(tas_pu)       <span class="co"># planning units</span>
<span class="kw">data</span>(tas_features) <span class="co"># biodiversity features</span></code></pre></div>
<p>Now, let’s have a look at the planning unit data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/print.html">print</a></span>(tas_pu)</code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 1130 
## extent      : 1080623, 1399989, -4840595, -4497092  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs 
## variables   : 5
## names       :   id,              cost, status, locked_in, locked_out 
## min values  :    1, 0.192488262910798,      0,         0,          0 
## max values  : 1130,  61.9272727272727,      2,         1,          0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">spplot</span>(tas_pu, <span class="dt">zcol =</span> <span class="st">"cost"</span>, <span class="dt">names.attr =</span> <span class="st">"Cost"</span>,
       <span class="dt">main =</span> <span class="st">"Planning Units and Cost"</span>, <span class="dt">col.regions =</span> <span class="kw">rev</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/reexports">viridis</a></span>(<span class="dv">100</span>)))</code></pre></div>
<p><img src="tasmania_files/figure-html/unnamed-chunk-4-1.png" width="336" style="display: block; margin: auto;"></p>
<p>Next, let examine the feature data. Here we will only plot the first four features as an example. The pixel values denote the presence or absence of each feature within the extent of the study area.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/print.html">print</a></span>(tas_features)</code></pre></div>
<pre><code>## class       : RasterStack 
## dimensions  : 343, 320, 109760, 62  (nrow, ncol, ncell, nlayers)
## resolution  : 1000, 1000  (x, y)
## extent      : 1080496, 1400496, -4841217, -4498217  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=aea +lat_1=-18 +lat_2=-36 +lat_0=0 +lon_0=132 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs 
## names       : layer.1, layer.2, layer.3, layer.4, layer.5, layer.6, layer.7, layer.8, layer.9, layer.10, layer.11, layer.12, layer.13, layer.14, layer.15, ... 
## min values  :       0,       0,       0,       0,       0,       0,       0,       0,       0,        0,        0,        0,        0,        0,        0, ... 
## max values  :       1,       1,       1,       1,       1,       1,       1,       1,       1,        1,        1,        1,        1,        1,        1, ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/rasterVis/topics/levelplot-methods">levelplot</a></span>(tas_features[[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]], <span class="dt">main =</span> <span class="st">"Ecological Features"</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),
          <span class="dt">col.regions =</span> <span class="kw">rev</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/reexports">magma</a></span>(<span class="dv">100</span>)))</code></pre></div>
<p><img src="tasmania_files/figure-html/unnamed-chunk-5-1.png" width="432" style="display: block; margin: auto;"></p>
<p>The planning units in this example are a spatial polygon layer—not a raster—and so there can be considerable flexibility in the shape of the planning units. That said, there is a trade-off with the efficiency of data pre-processing in vector-based planning unit data compared to raster-based planning unit data. Vector-based planning unit data generally require more time to complete pre-processing computations (e.g. overlaying the planning unit data with the feature data, or generating boundary data). As a consequence, we generally recommend using raster-based planning unit data where possible to reduce processing time—but note that this is not possible when not all planning units are equal-sized squares. Another strategy is to complete the pre-processsing in other software environments (e.g. <em>ArcGIS</em>) and use the pre-processed data directly with the <em>prioritizr</em> package.</p>
</div>
<div id="marxan-problem-formulation" class="section level3">
<h3 class="hasAnchor">
<a href="#marxan-problem-formulation" class="anchor"></a><em>Marxan</em> problem formulation</h3>
<p>Here, we will provide an example of using the <code>marxan_problem</code> function to build and solve a typical <em>Marxan</em> conservation planning problem. Then we will show how this same problem can be built and solved using the fully customizable <code>problem</code> function as a comparison.</p>
<p>The data set used in this example follows many of the conventions used by the <em>Marxan</em> decision support tool. As a consequence, it is not too difficult to format the data for use with the <code>marxan_problem</code> function. The <code>marxan_problem</code> function is essentially a wrapper to the <code>problem</code> function. This means that when we solve problems created using the <code>marxan_problem</code> function, we will solve them using exact algorithms and not the simulated annealing algorithm used by <em>Marxan</em>.</p>
<p>All problem objects formulated with <code>marxan_problem</code> use the minimum set objective. Targets can be either relative or absolute, and planning units can be specified for masking in or out using the <code>locked_in</code> and <code>locked_out</code> arguments. To favor clumped solutions, use the <code>penalty</code> argument to impose a penalty on solutions with high boundary lengths (equivalent to the Boundary Length Modifier (BLM) used in <em>Marxan</em>), and the <code>edge_factor</code> argument to scale the penalty for edges that do not have neighboring planning units, such as the coastline. For simplicity we set all of the targets at the same level, 17 %, to reflect the <a href="https://www.cbd.int/sp/targets/">Aichi</a> biodiversity target to “safeguard” at least 17% of terrestrial ecosystems by 2020. For example, to prioritize planning units in Tasmania that meet the 17 % representation target at the least cost.</p>
<p>First, we will convert the vector-based planning unit data and raster-based feature data into the tabular formats required by the <code>marxan_problem</code> function. These formats are very similar to the formats used by <em>Marxan</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create table with planning unit data</span>
pu_data &lt;-<span class="st"> </span>tas_pu<span class="op">@</span>data

<span class="co"># print first six rows</span>
<span class="kw">head</span>(pu_data)</code></pre></div>
<pre><code>##   id     cost status locked_in locked_out
## 2  1 60.24638      0     FALSE      FALSE
## 3  2 19.86301      0     FALSE      FALSE
## 4  3 59.68051      0     FALSE      FALSE
## 5  4 32.41614      0     FALSE      FALSE
## 6  5 26.17706      0     FALSE      FALSE
## 7  6 51.26218      0     FALSE      FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create table with the feature identifiers, names, and targets</span>
spec_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="kw">seq_len</span>(<span class="kw">nlayers</span>(tas_features)),
                        <span class="dt">name =</span> <span class="kw">paste0</span>(<span class="st">"veg"</span>, <span class="kw">seq_len</span>(<span class="kw">nlayers</span>(tas_features))),
                        <span class="dt">prop =</span> <span class="fl">0.17</span>)

<span class="co"># print first six rows</span>
<span class="kw">head</span>(spec_data)</code></pre></div>
<pre><code>##   id name prop
## 1  1 veg1 0.17
## 2  2 veg2 0.17
## 3  3 veg3 0.17
## 4  4 veg4 0.17
## 5  5 veg5 0.17
## 6  6 veg6 0.17</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create table with the planning unit vs. feature data</span>
puvspr_data &lt;-<span class="st"> </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/rij_matrix.html">rij_matrix</a></span>(tas_pu, tas_features)
puvspr_data &lt;-<span class="st"> </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/as.html">as</a></span>(puvspr_data, <span class="st">"dgTMatrix"</span>)
puvspr_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">pu =</span> puvspr_data<span class="op">@</span>j <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">species =</span> puvspr_data<span class="op">@</span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,
                          <span class="dt">amount =</span> puvspr_data<span class="op">@</span>x)

<span class="co"># print first six rows</span>
<span class="kw">head</span>(puvspr_data)</code></pre></div>
<pre><code>##   pu species     amount
## 1  3      54 0.02777778
## 2  3      59 0.33333333
## 3  5      30 0.05000000
## 4  6      27 0.03225806
## 5  6      35 0.03225806
## 6  7      12 0.01587302</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create table with the boundary data</span>
bound_data &lt;-<span class="st"> </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/boundary_matrix.html">boundary_matrix</a></span>(tas_pu)
bound_data &lt;-<span class="st"> </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/as.html">as</a></span>(bound_data, <span class="st">"dgTMatrix"</span>)
bound_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id1 =</span> bound_data<span class="op">@</span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">id2 =</span> bound_data<span class="op">@</span>j <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,
                         <span class="dt">boundary =</span> bound_data<span class="op">@</span>x)
<span class="co"># print first six rows</span>
<span class="kw">head</span>(bound_data)</code></pre></div>
<pre><code>##   id1 id2  boundary
## 1   1   1 10259.010
## 2   3   1  3899.140
## 3   6   1   153.133
## 4   2   2 23878.508
## 5   4   2  3212.811
## 6   7   2  4725.951</code></pre>
<p>Now that we have converted the data to tabular format, we can use the <code>marxan_problem</code> function to create a conservation planning problem.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create problem</span>
p1 &lt;-<span class="st"> </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/marxan_problem.html">marxan_problem</a></span>(pu_data, spec_data, puvspr_data, bound_data,
                     <span class="dt">blm =</span> <span class="fl">0.0005</span>)</code></pre></div>
<pre><code>## Found more than one class "tbl_df" in cache; using the first, from namespace 'prioritizr'</code></pre>
<pre><code>## Also defined by 'tibble'</code></pre>
<pre><code>## Found more than one class "tbl_df" in cache; using the first, from namespace 'prioritizr'</code></pre>
<pre><code>## Also defined by 'tibble'</code></pre>
<pre><code>## Found more than one class "tbl_df" in cache; using the first, from namespace 'prioritizr'</code></pre>
<pre><code>## Also defined by 'tibble'</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># print problem</span>
<span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/print.html">print</a></span>(p1)</code></pre></div>
<pre><code>## Conservation Problem
##   planning units: data.frame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       veg1, veg2, veg3, ... (62 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.17, max: 0.17)]
##   decisions:      default
##   constraints:    &lt;Locked in planning units [257 locked units]&gt;
##   penalties:      &lt;Boundary penalties [edge factor (min: 1, max: 1), penalty (5e-04), zones]&gt;
##   portfolio:      default
##   solver:         default</code></pre>
<p>Next, we can solve the problem. The <em>prioritizr</em> R package supports three different exact algorithm software packages: <em>gurobi</em>, <em>Rsymphony</em>, and <em>lpsymphony</em>. There are costs and benefits associated with each of these different solvers, but each software should return similar results. Note that you will need at least one of these package installed on your system to solve problems. We recommend using the <em>gurobi</em> solver if possible, and have used this solver when building this tutorial. After solving the problem, we will calculate some statistics to describe the solution. Note that the planning unit selections are stored in the “solution_1” column of the solution object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># solve problem</span>
s1 &lt;-<span class="st"> </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/solve.html">solve</a></span>(p1)</code></pre></div>
<pre><code>## Found more than one class "tbl_df" in cache; using the first, from namespace 'prioritizr'</code></pre>
<pre><code>## Also defined by 'tibble'</code></pre>
<pre><code>## Found more than one class "tbl_df" in cache; using the first, from namespace 'prioritizr'</code></pre>
<pre><code>## Also defined by 'tibble'</code></pre>
<pre><code>## Found more than one class "tbl_df" in cache; using the first, from namespace 'prioritizr'</code></pre>
<pre><code>## Also defined by 'tibble'</code></pre>
<pre><code>## Optimize a model with 6358 rows, 4278 columns and 14152 nonzeros
## Variable types: 0 continuous, 4278 integer (4278 binary)
## Coefficient statistics:
##   Matrix range     [1e-02, 1e+00]
##   Objective range  [5e-02, 2e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [3e-03, 3e+00]
## Found heuristic solution: objective 30514.663295
## Found heuristic solution: objective 12420.567371
## Presolve removed 1796 rows and 1172 columns
## Presolve time: 0.05s
## Presolved: 4562 rows, 3106 columns, 10000 nonzeros
## Found heuristic solution: objective 12636.553370
## Found heuristic solution: objective 11649.433125
## Variable types: 0 continuous, 3106 integer (3106 binary)
## Presolved: 4562 rows, 3106 columns, 10000 nonzeros
## 
## 
## Root relaxation: objective 1.072358e+04, 787 iterations, 0.05 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 10723.5767    0  118 11649.4331 10723.5767  7.95%     -    0s
## 
## Explored 1 nodes (787 simplex iterations) in 0.13 seconds
## Thread count was 1 (of 4 available processors)
## 
## Solution count 4: 11649.4 12417.3 12636.6 29785.4 
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 1.164943312508e+04, best bound 1.072357667965e+04, gap 7.9477%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># print first six rows of solution object</span>
<span class="kw">head</span>(s1)</code></pre></div>
<pre><code>##   id     cost status locked_in locked_out solution_1
## 2  1 60.24638      0     FALSE      FALSE          0
## 3  2 19.86301      0     FALSE      FALSE          0
## 4  3 59.68051      0     FALSE      FALSE          0
## 5  4 32.41614      0     FALSE      FALSE          0
## 6  5 26.17706      0     FALSE      FALSE          0
## 7  6 51.26218      0     FALSE      FALSE          0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># count number of planning units in solution</span>
<span class="kw">sum</span>(s1<span class="op">$</span>solution_<span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] 319</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># proportion of planning units in solution</span>
<span class="kw">mean</span>(s1<span class="op">$</span>solution_<span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] 0.2823009</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># visualize the solution by converting the solution to a spatial object</span>
s1 &lt;-<span class="st"> </span><span class="kw">SpatialPolygonsDataFrame</span>(<span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/as.html">as</a></span>(tas_pu, <span class="st">"SpatialPolygons"</span>), <span class="dt">data =</span> s1)
s1<span class="op">$</span>solution_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">factor</span>(s1<span class="op">$</span>solution_<span class="dv">1</span>)
<span class="kw">spplot</span>(s1, <span class="st">"solution_1"</span>, <span class="dt">col.regions =</span> <span class="kw">c</span>(<span class="st">"grey90"</span>, <span class="st">"darkgreen"</span>),
       <span class="dt">main =</span> <span class="st">"marxan_problem solution"</span>)</code></pre></div>
<p><img src="tasmania_files/figure-html/unnamed-chunk-8-1.png" width="336" style="display: block; margin: auto;"></p>
</div>
<div id="general-problem-formulation" class="section level3">
<h3 class="hasAnchor">
<a href="#general-problem-formulation" class="anchor"></a>General problem formulation</h3>
<p>Now we will formulate the exact same problem using the <code>problem</code> function and the spatially referenced data. We recommend using this approach instead of the <code>marxan_problem</code> because it is more verbose and you can specify exactly how the conservation planning problem should be formulated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># build problem</span>
p2 &lt;-<span class="st"> </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/problem.html">problem</a></span>(tas_pu, tas_features, <span class="dt">cost_column =</span> <span class="st">"cost"</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/add_min_set_objective.html">add_min_set_objective</a></span>() <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/add_relative_targets.html">add_relative_targets</a></span>(<span class="fl">0.17</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span>(<span class="st">"locked_in"</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/add_binary_decisions.html">add_binary_decisions</a></span>() <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/add_boundary_penalties.html">add_boundary_penalties</a></span>(<span class="dt">penalty =</span> <span class="fl">0.0005</span>, <span class="dt">edge_factor =</span> <span class="dv">1</span>)

<span class="co"># print the problem</span>
<span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/print.html">print</a></span>(p2)</code></pre></div>
<pre><code>## Conservation Problem
##   planning units: SpatialPolygonsDataFrame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       layer.1, layer.2, layer.3, ... (62 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.17, max: 0.17)]
##   decisions:      Binary decision 
##   constraints:    &lt;Locked in planning units [257 locked units]&gt;
##   penalties:      &lt;Boundary penalties [edge factor (min: 1, max: 1), penalty (5e-04), zones]&gt;
##   portfolio:      default
##   solver:         default</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># solve problem</span>
s2 &lt;-<span class="st"> </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/solve.html">solve</a></span>(p2)</code></pre></div>
<pre><code>## Optimize a model with 6358 rows, 4278 columns and 14152 nonzeros
## Variable types: 0 continuous, 4278 integer (4278 binary)
## Coefficient statistics:
##   Matrix range     [1e-02, 1e+00]
##   Objective range  [5e-02, 2e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [3e-03, 3e+00]
## Found heuristic solution: objective 30514.663295
## Found heuristic solution: objective 12420.567371
## Presolve removed 1796 rows and 1172 columns
## Presolve time: 0.03s
## Presolved: 4562 rows, 3106 columns, 10000 nonzeros
## Found heuristic solution: objective 12636.553370
## Found heuristic solution: objective 11649.433125
## Variable types: 0 continuous, 3106 integer (3106 binary)
## Presolved: 4562 rows, 3106 columns, 10000 nonzeros
## 
## 
## Root relaxation: objective 1.072358e+04, 787 iterations, 0.05 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 10723.5767    0  118 11649.4331 10723.5767  7.95%     -    0s
## 
## Explored 1 nodes (787 simplex iterations) in 0.10 seconds
## Thread count was 1 (of 4 available processors)
## 
## Solution count 4: 11649.4 12417.3 12636.6 29785.4 
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 1.164943312508e+04, best bound 1.072357667965e+04, gap 7.9477%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># visualize solution</span>
s2<span class="op">$</span>solution_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">factor</span>(s2<span class="op">$</span>solution_<span class="dv">1</span>)
<span class="kw">spplot</span>(s2, <span class="st">"solution_1"</span>, <span class="dt">col.regions =</span> <span class="kw">c</span>(<span class="st">"grey90"</span>, <span class="st">"darkgreen"</span>),
       <span class="dt">main =</span> <span class="st">"problem solution"</span>)</code></pre></div>
<p><img src="tasmania_files/figure-html/unnamed-chunk-9-1.png" width="336" style="display: block; margin: auto;"></p>
</div>
<div id="selection-frequencies" class="section level3">
<h3 class="hasAnchor">
<a href="#selection-frequencies" class="anchor"></a>Selection frequencies</h3>
<p>Similar to the <em>Marxan</em> decision support tool, we can generate a portfolio of solutions and compute the planning unit selection frequencies to understand their relative importance. This can be useful when trying to understand which planning units in the solution are the most irreplaceable. To do this, we will create a portfolio containing 50 solutions, remove the duplicate solutions, and calculate the number of each planning unit was selected. Although this step can take a while to finish, it can be sped using the <code>threads</code> parameter in the <code>add_shuffle_portfolio</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create new problem with a portfolio added to it</span>
p3 &lt;-<span class="st"> </span>p2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/add_shuffle_portfolio.html">add_shuffle_portfolio</a></span>(<span class="dv">50</span>, <span class="dt">remove_duplicates =</span> <span class="ot">TRUE</span>)

<span class="co"># print problem</span>
<span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/print.html">print</a></span>(p3)</code></pre></div>
<pre><code>## Conservation Problem
##   planning units: SpatialPolygonsDataFrame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       layer.1, layer.2, layer.3, ... (62 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.17, max: 0.17)]
##   decisions:      Binary decision 
##   constraints:    &lt;Locked in planning units [257 locked units]&gt;
##   penalties:      &lt;Boundary penalties [edge factor (min: 1, max: 1), penalty (5e-04), zones]&gt;
##   portfolio:      Shuffle portfolio [number_solutions (50), remove_duplicates (1), threads (1)]
##   solver:         default</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># generate solutions</span>
s3 &lt;-<span class="st"> </span><span class="kw"><a href="http://prioritizr.github.io/prioritizr/reference/solve.html">solve</a></span>(p3)

<span class="co"># find column numbers with the solutions</span>
solution_columns &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">grepl</span>(<span class="st">"solution"</span>, <span class="kw">names</span>(s3)))

<span class="co"># calculate selection frequencies</span>
s3<span class="op">$</span>selection_frequencies &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">as.matrix</span>(s3<span class="op">@</span>data[, solution_columns]))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot first four solutions in the portfolio</span>
s3<span class="op">$</span>solution_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">factor</span>(s3<span class="op">$</span>solution_<span class="dv">1</span>)
s3<span class="op">$</span>solution_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">factor</span>(s3<span class="op">$</span>solution_<span class="dv">2</span>)
s3<span class="op">$</span>solution_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">factor</span>(s3<span class="op">$</span>solution_<span class="dv">3</span>)
s3<span class="op">$</span>solution_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">factor</span>(s3<span class="op">$</span>solution_<span class="dv">4</span>)
<span class="kw">spplot</span>(s3, <span class="dt">zcol =</span> <span class="kw">c</span>(<span class="st">"solution_1"</span>, <span class="st">"solution_2"</span>, <span class="st">"solution_3"</span>, <span class="st">"solution_4"</span>),
       <span class="dt">col.regions =</span> <span class="kw">c</span>(<span class="st">"grey90"</span>, <span class="st">"darkgreen"</span>))</code></pre></div>
<p><img src="tasmania_files/figure-html/unnamed-chunk-12-1.png" width="432" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot histogram of selection frequencies</span>
<span class="kw">hist</span>(s3<span class="op">$</span>selection_frequencies, <span class="dt">main =</span> <span class="st">"Selection frequencies"</span>,
     <span class="dt">xlab =</span> <span class="st">"Number of times different planning units were selected"</span>)</code></pre></div>
<p><img src="tasmania_files/figure-html/unnamed-chunk-13-1.png" width="336" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot spatial distribution of the selection frequencies</span>
<span class="kw">spplot</span>(s3, <span class="st">"selection_frequencies"</span>, <span class="dt">main =</span> <span class="st">"Selection frequencies"</span>,
       <span class="dt">col.regions =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/reexports">viridis</a></span>(<span class="dv">100</span>))</code></pre></div>
<p><img src="tasmania_files/figure-html/unnamed-chunk-13-2.png" width="336" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://jeffrey-hanson.com">Jeffrey O Hanson</a>, <a href="http://www.richard-schuster.com/">Richard Schuster</a>, Nina Morrell, <a href="http://strimas.com">Matthew Strimas-Mackey</a>, Matthew E Watts, <a href="http://arcese.forestry.ubc.ca">Peter Arcese</a>, <a href="https://josephrbennett.wordpress.com/">Joeseph Bennett</a>, Hugh P Possingham.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
